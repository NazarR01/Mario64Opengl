using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class MarioInvulnerability : MonoBehaviour
{
     private bool invulnerable = false;
    private Material[] materials;

    void Start()
    {
        // Conseguir todos los materiales de todos los renderers hijos
        Renderer[] rends = GetComponentsInChildren<Renderer>();
        List<Material> mats = new List<Material>();

        foreach (Renderer rend in rends)
        {
            mats.AddRange(rend.materials);
        }
        materials = mats.ToArray();
    }

    public bool IsInvulnerable()
    {
        return invulnerable;
    }

    public void StartInvulnerability(float duration)
    {
        if (!invulnerable)
            StartCoroutine(InvulnerabilityCoroutine(duration));
    }

    private IEnumerator InvulnerabilityCoroutine(float duration)
    {
        invulnerable = true;

        float blinkInterval = 0.2f;
        float elapsed = 0f;

        while (elapsed < duration)
        {
            SetMaterialsAlpha(0.2f); // semi-transparente
            yield return new WaitForSeconds(blinkInterval);
            SetMaterialsAlpha(1f);   // opaco (visible)
            yield return new WaitForSeconds(blinkInterval);

            elapsed += blinkInterval * 2;
        }

        invulnerable = false;
        SetMaterialsAlpha(1f); // asegurarse que quede visible al final
    }

    private void SetMaterialsAlpha(float alpha)
    {
        if (materials == null) return;

        foreach (Material mat in materials)
        {
            Color c = mat.color;
            c.a = alpha;
            mat.color = c;
        }
    }
}
